<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ÙˆÙ… Ù…Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠÙˆÙ…ÙŠØ© ÙˆØªØ°ÙƒÙŠØ± Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ†</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#00796b" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #e0f7fa, #ffffff);
      color: #333;
      padding: 30px;
      max-width: 600px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      color: #00796b;
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-top: 15px;
      text-align: right;
    }
    input[type="time"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    textarea {
      width: 100%;
      height: 120px;
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    button {
      margin-top: 25px;
      padding: 12px 20px;
      background-color: #00796b;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #004d40;
    }
    .result, .advice {
      margin-top: 20px;
      font-size: 18px;
      text-align: right;
    }
    .warning {
      color: #c0392b;
      font-weight: bold;
    }
    .notes-container {
      margin-top: 30px;
      text-align: right;
    }
  </style>
</head>
<body>

  <h1>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ÙˆÙ… Ù…Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠÙˆÙ…ÙŠØ© ÙˆØªØ°ÙƒÙŠØ± Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ†</h1>

  <label for="sleepTime">ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…:</label>
  <input type="time" id="sleepTime"><br>

  <label for="wakeTime">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸:</label>
  <input type="time" id="wakeTime"><br>

  <button onclick="calculateSleep()">Ø§Ø­Ø³Ø¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ…</button>

  <div class="result" id="sleepResult"></div>
  <div class="advice" id="sleepAdvice"></div>

  <div class="notes-container">
    <label for="dailyNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</label>
    <textarea id="dailyNotes" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></textarea>
  </div>

  <script>
    // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    if (Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    // Ø¬Ø¯ÙˆÙ„Ø© Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…
    function scheduleSleepNotification(timeStr) {
      const [hours, minutes] = timeStr.split(":").map(Number);
      const now = new Date();
      const target = new Date();
      target.setHours(hours, minutes, 0, 0);
      if (target < now) target.setDate(target.getDate() + 1);

      const delay = target.getTime() - now.getTime();

      setTimeout(() => {
        if (Notification.permission === "granted") {
          new Notification("ğŸ›Œ Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…!", {
            body: "Ù„ØµØ­Ø© Ø£ÙØ¶Ù„ØŒ Ø­Ø§ÙˆÙ„ Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¢Ù†.",
            icon: "https://cdn-icons-png.flaticon.com/512/833/833472.png"
          });
        }
      }, delay);
    }

    // Ø¬Ø¯ÙˆÙ„Ø© ØªØ°ÙƒÙŠØ± Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ø§Ù„Ø³Ø§Ø¹Ø© 7 Ù…Ø³Ø§Ø¡Ù‹ (19:00)
    function scheduleNoSmokingReminder() {
      function scheduleNextReminder() {
        const now = new Date();
        const target = new Date();
        target.setHours(21, 25, 0, 0); // 9:00 Ù…Ø³Ø§Ø¡Ù‹ Ø§Ù„ÙŠÙˆÙ…
        if (target <= now) {
          target.setDate(target.getDate() + 1); // Ø§Ù„ØºØ¯
        }
        const delay = target.getTime() - now.getTime();

        setTimeout(() => {
          if (Notification.permission === "granted") {
            new Notification("ğŸš­ ØªØ°ÙƒÙŠØ± Ø¨Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ†", {
              body: "Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØµØ­ØªÙƒ! ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ø§Ù„Ø¢Ù†.",
              icon: "https://cdn-icons-png.flaticon.com/512/2913/2913469.png"
            });
          }
          scheduleNextReminder(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
        }, delay);
      }
      scheduleNextReminder();
    }

    function calculateSleep() {
      const sleepTime = document.getElementById('sleepTime').value;
      const wakeTime = document.getElementById('wakeTime').value;

      if (!sleepTime || !wakeTime) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ… ÙˆÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸');
        return;
      }

      // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…
      localStorage.setItem('sleepTime', sleepTime);
      localStorage.setItem('wakeTime', wakeTime);

      // Ø¬Ø¯ÙˆÙ„Ø© Ø¥Ø´Ø¹Ø§Ø± ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…
      scheduleSleepNotification(sleepTime);

      const [sleepHours, sleepMinutes] = sleepTime.split(":").map(Number);
      const [wakeHours, wakeMinutes] = wakeTime.split(":").map(Number);

      let sleep = new Date();
      sleep.setHours(sleepHours, sleepMinutes);

      let wake = new Date();
      wake.setHours(wakeHours, wakeMinutes);

      if (wake <= sleep) {
        wake.setDate(wake.getDate() + 1); // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
      }

      const diffMs = wake - sleep;
      const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
      const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
      const totalHours = diffHours + diffMinutes / 60;

      document.getElementById('sleepResult').innerHTML = `Ù†Ù…Øª Ù„Ù…Ø¯Ø© <strong>${diffHours} Ø³Ø§Ø¹Ø© Ùˆ ${diffMinutes} Ø¯Ù‚ÙŠÙ‚Ø©</strong>.`;

      let advice = "";
      if (totalHours < 6) {
        advice = "<span class='warning'>âš ï¸ Ù†ÙˆÙ…Ùƒ Ø£Ù‚Ù„ Ù…Ù† 6 Ø³Ø§Ø¹Ø§Øª! Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ ØªØ¹Ø¨Ù‹Ø§ØŒ Ù‚Ù„Ø© ØªØ±ÙƒÙŠØ²ØŒ Ø£Ùˆ Ø¶Ø¹Ù ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø¹Ø©.</span><br>ğŸ›Œ Ø­Ø§ÙˆÙ„ Ø§Ù„Ù†ÙˆÙ… Ù…Ù† 7 Ø¥Ù„Ù‰ 9 Ø³Ø§Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹.";
      } else if (totalHours >= 6 && totalHours < 8) {
        advice = "ğŸ™‚ Ù†ÙˆÙ…Ùƒ Ø¬ÙŠØ¯ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø³ÙŠÙ†Ù‡ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ 8 Ø³Ø§Ø¹Ø§Øª Ù„ØµØ­Ø© Ø£ÙØ¶Ù„.";
      } else {
        advice = "âœ… Ù…Ù…ØªØ§Ø²! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ù†ÙˆÙ… ÙƒØ§ÙÙ ÙŠØ¯Ø¹Ù… ØµØ­ØªÙƒ Ø§Ù„Ø¬Ø³Ø¯ÙŠØ© ÙˆØ§Ù„Ø¹Ù‚Ù„ÙŠØ©.";
      }

      document.getElementById('sleepAdvice').innerHTML = advice;
    }

    // Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹
    const notesTextarea = document.getElementById('dailyNotes');

    function getTodayKey() {
      const today = new Date();
      return 'notes-' + today.toISOString().slice(0,10); // ØµÙŠØºØ© YYYY-MM-DD
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.onload = function () {
      // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ… ÙˆØ§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸
      const savedSleep = localStorage.getItem('sleepTime');
      const savedWake = localStorage.getItem('wakeTime');
      if (savedSleep && savedWake) {
        document.getElementById('sleepTime').value = savedSleep;
        document.getElementById('wakeTime').value = savedWake;
        calculateSleep();
      }

      // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
      const todayNotes = localStorage.getItem(getTodayKey());
      if (todayNotes) {
        notesTextarea.value = todayNotes;
      }

      // Ø¬Ø¯ÙˆÙ„Ø© ØªØ°ÙƒÙŠØ± Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ø§Ù„Ø³Ø§Ø¹Ø© 7 Ù…Ø³Ø§Ø¡Ù‹
      scheduleNoSmokingReminder();
    };

    // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
    notesTextarea.addEventListener('input', () => {
      localStorage.setItem(getTodayKey(), notesTextarea.value);
    });

    // ØªØ³Ø¬ÙŠÙ„ Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('âœ… Service Worker Ù…Ø³Ø¬Ù„'))
        .catch(err => console.error('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker:', err));
    }
  </script>
</body>
</html>
